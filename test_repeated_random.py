#!/usr/bin/env python3

from ipaddress import ip_address
import sys

import i_dunno

cases = [
{"addr": "107.11.190.165", "minimum": ["35d0ae7d25", "3542ddbd25", "cd982e7d25"], "satisfactory": [], "delightful": []},
{"addr": "59.98.214.58", "minimum": ["1d585ad8ba", "c79b0b2c3a", "1dd68b2c3a", "1d58d6ac3a"], "satisfactory": ["1d585ad8ba", "c79b0b2c3a", "1dd68b2c3a", "1d58d6ac3a"], "delightful": ["1d585ad8ba", "c79b0b2c3a", "1dd68b2c3a", "1d58d6ac3a"]},
{"addr": "163.35.207.16", "minimum": ["d4990f1e10", "51d28f1e10", "5148de9e10"], "satisfactory": ["d4990f1e10", "51d28f1e10", "5148de9e10"], "delightful": ["5148de9e10", "51d28f1e10"]},
{"addr": "224.186.218.92", "minimum": ["702ed6b45c", "dc856b345c", "702e5bc99c", "70cbab345c"], "satisfactory": [], "delightful": []},
{"addr": "159.243.0.179", "minimum": ["d3bf4c0133", "4f7cd88133", "4fdf8c0133"], "satisfactory": ["d3bf4c0133", "4f7cd88133", "4fdf8c0133"], "delightful": ["d3bf4c0133", "4f7cd88133", "4fdf8c0133"]},
{"addr": "249.59.75.15", "minimum": ["7c4e69cc8f", "7c4eda960f", "df896d160f", "7cd3ad160f"], "satisfactory": ["7c4e69cc8f", "7c4eda960f", "df896d160f", "7cd3ad160f"], "delightful": ["7c4eda960f", "7c4e69cc8f", "df896d160f", "7cd3ad160f"]},
{"addr": "9.149.157.2", "minimum": ["046533d482", "04d9963a02", "0465ccba02"], "satisfactory": ["046533d482", "04d9963a02", "0465ccba02"], "delightful": ["046533d482", "04d9963a02", "0465ccba02"]},
{"addr": "244.237.40.124", "minimum": ["7aceb4507c", "dea734507c", "7a3bc9907c"], "satisfactory": ["7aceb4507c", "7a3bc9907c", "dea734507c"], "delightful": ["7aceb4507c", "7a3bc9907c", "dea734507c"]},
{"addr": "144.107.40.244", "minimum": ["d2832c5174", "481ad99174"], "satisfactory": ["481ad99174"], "delightful": ["481ad99174"]},
{"addr": "142.110.155.212", "minimum": ["d1b33a3754", "471bd4b754", "471b53cf94"], "satisfactory": ["471bd4b754", "471b53cf94"], "delightful": ["471bd4b754", "471b53cf94"]},
{"addr": "::5190:20e0", "minimum": ["000000000000000000000000000123e2818160", "00000000000000000000000000012310e283a0", "0000000000000000000000000001e499804160"], "satisfactory": ["00000000000000000000000000012310e283a0", "0000000000000000000000000001e499804160"], "delightful": ["0000000000000000000000000001e499804160"]},
{"addr": "::305e:ae9d", "minimum": ["0000000000000000000000000000605eeaba9d", "0000000000000000000000000000ec85ba5d1d", "000000000000000000000000000060ebb59d1d"], "satisfactory": ["000000000000000000000000000060ebb59d1d", "0000000000000000000000000000ec85ba5d1d", "0000000000000000000000000000605eeaba9d"], "delightful": ["0000000000000000000000000000605eeaba9d", "000000000000000000000000000060ebb59d1d"]},
{"addr": "::d324:f82b", "minimum": ["00000000000000000000000000032624efa0ab", "0000000000000000000000000003e4b293702b", "000000000000000000000000000326e4a7b02b"], "satisfactory": ["00000000000000000000000000032624efa0ab", "0000000000000000000000000003e4b293702b", "000000000000000000000000000326e4a7b02b"], "delightful": ["00000000000000000000000000032624efa0ab", "0000000000000000000000000003e4b293702b", "000000000000000000000000000326e4a7b02b"]},
{"addr": "::3a54:8745", "minimum": ["000000000000000000000000000074eaa48e45", "00000000000000000000000000007454e89d85", "0000000000000000000000000000eea5920e45"], "satisfactory": ["000000000000000000000000000074eaa48e45", "00000000000000000000000000007454e89d85", "0000000000000000000000000000eea5920e45"], "delightful": ["000000000000000000000000000074eaa48e45", "00000000000000000000000000007454e89d85", "0000000000000000000000000000eea5920e45"]},
{"addr": "::fefe:ce93", "minimum": ["00000000000000000000000000037defb69d13", "0000000000000000000000000003efafbb1d13", "00000000000000000000000000037d7eecba93"], "satisfactory": ["00000000000000000000000000037defb69d13", "0000000000000000000000000003efafbb1d13", "00000000000000000000000000037d7eecba93"], "delightful": ["00000000000000000000000000037defb69d13", "0000000000000000000000000003efafbb1d13", "00000000000000000000000000037d7eecba93"]},
{"addr": "::c987:857", "minimum": ["0000000000000000000000000003e2989c1057"], "satisfactory": ["0000000000000000000000000003e2989c1057"], "delightful": ["0000000000000000000000000003e2989c1057"]},
{"addr": "::9b62:53b6", "minimum": ["00000000000000000000000000023662e58eb6", "000000000000000000000000000236ec92a736", "0000000000000000000000000002e6b6892736"], "satisfactory": ["00000000000000000000000000023662e58eb6", "000000000000000000000000000236ec92a736", "0000000000000000000000000002e6b6892736"], "delightful": ["00000000000000000000000000023662e58eb6", "000000000000000000000000000236ec92a736", "0000000000000000000000000002e6b6892736"]},
{"addr": "::e0d4:35d6", "minimum": ["0000000000000000000000000003e88d906b56", "00000000000000000000000000034154e39796", "000000000000000000000000000341eaa1ab56"], "satisfactory": ["0000000000000000000000000003e88d906b56", "00000000000000000000000000034154e39796", "000000000000000000000000000341eaa1ab56"], "delightful": ["0000000000000000000000000003e88d906b56", "00000000000000000000000000034154e39796", "000000000000000000000000000341eaa1ab56"]},
{"addr": "::7a90:6658", "minimum": ["00000000000000000000000000017510e69998", "0000000000000000000000000001eea9814c58", "000000000000000000000000000175e2838c58"], "satisfactory": ["00000000000000000000000000017510e69998", "0000000000000000000000000001eea9814c58", "000000000000000000000000000175e2838c58"], "delightful": ["00000000000000000000000000017510e69998", "0000000000000000000000000001eea9814c58", "000000000000000000000000000175e2838c58"]},
{"addr": "::9ac5:acdd", "minimum": ["0000000000000000000000000002e6ac96595d", "00000000000000000000000000023545eab39d", "000000000000000000000000000235e8ad995d"], "satisfactory": ["0000000000000000000000000002e6ac96595d", "00000000000000000000000000023545eab39d", "000000000000000000000000000235e8ad995d"], "delightful": ["0000000000000000000000000002e6ac96595d", "00000000000000000000000000023545eab39d", "000000000000000000000000000235e8ad995d"]},
]


def assert_encodes_expected(case, level):
    addr = ip_address(case["addr"])
    expected = case[level]

    for i in range(1000):
        try:
            actual = i_dunno.encode(addr, level=level).hex()
        except ValueError:
            actual = None

        if actual is None:
            if expected != []:
                raise AssertionError(
                    ('Unable to encode {} at level {} even though we ' +
                    'expected one of {}').format(
                        addr, level, expected
                    )
                )
        elif actual not in expected:
            raise AssertionError(
                ('{} was encoded as {} at level {} but we expected ' +
                'one of {}').format(
                    addr, actual, level, expected
                )
            )

def log(msg):
    sys.stdout.write(msg)
    sys.stdout.flush()


log('Testing')
for case in cases:
    log('.')
    assert_encodes_expected(case, 'minimum')
    assert_encodes_expected(case, 'satisfactory')
    assert_encodes_expected(case, 'delightful')
log('\nTest passed.\n')
